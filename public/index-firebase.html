<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!--
        The width=device-width part sets the width of the page to follow the screen-width of the device (which will vary depending on the device).
        The initial-scale=1 part sets the initial zoom level when the page is first loaded by the browser.
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- I think search engines use the keywords -->
    <meta name="keywords" content="Java, Spring, Developer, Raspberry Pi, Beaglebone, Projects">
    <link rel="stylesheet" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" href="css/bootstrap-theme.min.css"/>
    <link rel="stylesheet" href="css/style-firebase.css"/>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="js/bootstrap.min.js" type="text/javascript"></script>


    <!-- This is what gives the nice scroll effect when I click a link    -->
    <script type="text/javascript">
        jQuery(document).ready(function($) {
            $(".scroll").click(function(event){
                event.preventDefault();
                $('html,body').animate({scrollTop:$(this.hash).offset().top - 53},1000);
            });
        });
    </script>

    <script src="https://www.gstatic.com/firebasejs/4.1.0/firebase.js"></script>
    <!--<script src="js/firebase.js"></script>-->
    <script>

        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyD948shiDf3MGUUvat45QCIvt97DSiJTW8",
            authDomain: "ryanpdev.firebaseapp.com",
            databaseURL: "https://ryanpdev.firebaseio.com",
            projectId: "ryanpdev",
            storageBucket: "ryanpdev.appspot.com",
            messagingSenderId: "536412277169"
        };
        firebase.initializeApp(config);

        var database = firebase.database().ref();


        /*
            User management functions
            -signup
            -login
            -auth state change
         */

        function signup(){
            console.log("Signing up!");

            const password = $('#password').val();
            const email = $('#email').val();

            console.log(firebase);

            firebase.auth().createUserWithEmailAndPassword(email, password).then(function(user) {
                        $('#login-signup-error-message').hide();
            }, function(error) {
                    var errorCode = error.code;
                    var errorMessage = error.message;

                    console.log(errorCode, errorMessage);
                $('#login-signup-error-message').show();
                $('#login-signup-error-message').html('<strong>Whoops!</strong> There was a problem signing you up.');
            }
            );
        }

        function login(){
            console.log("Logging in!");

            const password = $('#password').val();
            const email = $('#email').val();

            firebase.auth().signInWithEmailAndPassword(email, password).then(function(user){
                console.log("Successfully logged in!", user);
                $('#login-signup-error-message').hide();
            },function(error) {
                // Handle Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
                console.log(errorCode, errorMessage);
                $('#login-signup-error-message').show();
                $('#login-signup-error-message').html('<strong>Whoops!</strong> You were unable to be logged in.');
            });
        }

        function logout(){
            firebase.auth().signOut();
        }

        firebase.auth().onAuthStateChanged(function(user) {
            console.log("Auth state changed");
            if (user) { //user is the same as firebase.auth().currentUser
                $('#login-signup-nav-item').css('color', '#449d44');
                $('#login-signup-nav-item').text(user.email);
                $('#login-signup-pane').modal('hide');
                console.log("showing");
                $('#logout-nav-item').show();
            } else {
                $('#login-signup-nav-item').text("Sign In");
                $('#login-signup-nav-item').css('color', '#9d9d9d');
                console.log("hiding");
                $('#logout-nav-item').hide();

            }
        });


        //nothing to do with firebase, should move elsewhere
        function togglePane(){
            $('#login-signup-pane').modal('toggle');
        }

        $('.expand-pane').click(togglePane());


        $(document).ready(function(){

        //page initialization code (won't be with firebase code probably)
        if(firebase.auth().currentUser){
            $('#logout-nav-item').show();
        }else{
            $('#logout-nav-item').hide();
        }
        });


    </script>

    <title>ryanpdev - Home</title>
</head>

<body class="container-fluid">
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">ryanpdev.com</a>
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
            <ul class="nav navbar-nav navbar-left">
                <li class="active"><a href="#home" class="scroll">Home</a></li>
                <li><a href="#about" class="scroll">About</a></li>
                <li><a href="#projects" class="scroll">Projects</a></li>
                <li><a href="#learning-log" class="scroll">Learning Log</a></li>
                <li><a href="#business-inquiries" class="scroll">Business Inquiries</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a id="login-signup-nav-item" onclick="togglePane()">Sign In</a></li>
                <li><a id="logout-nav-item" onclick="logout()">Log Out</a></li>
            </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Modal -->
        <div class="modal fade" id="login-signup-pane" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Login/Sign Up</h4>
                    </div>
                    <div class="modal-body">
                        <div class="login-signup-pane">
                            <!--<div class="col-xs-12">-->
                                <div class="row center-block">
                                    <form onsubmit="return false;">
                                        <div class="form-group">
                                            <label for="email">Email:</label>
                                            <input type="email" class="form-control" id="email" placeholder="Enter email" name="email">
                                        </div>
                                        <div class="form-group">
                                            <label for="password">Password:</label>
                                            <input type="password" class="form-control" id="password" placeholder="Enter password" name="pwd">
                                        </div>
                                    </form>
                                    <div id="login-signup-error-message" class="alert alert-danger" hidden>
                                    </div>
                                </div>
                            <!--</div>-->
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-default" onclick="signup()">Sign Up</button>
                        <button class="btn btn-primary" onclick="login()">Log In</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="main-body" class="col-xs-12 main-body">
        Here is where the content for the main body will go
    </div>

</body>

</html>


