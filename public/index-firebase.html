<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Software engineering bio website for Ryan Pelletier">
    <meta name="keywords" content="Java, Spring, Engineer, Raspberry Pi, Beaglebone, Projects, DIY">
    <meta name="author" content="Ryan Pelletier">

    <!-- JQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>

    <!-- Bootstrap libary-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="css/style-firebase.css"/>


    <!-- This is what gives the nice scroll effect when I click a link, this will be removed in the future probably, I don't want the site to get too big    -->
    <script type="text/javascript">
        jQuery(document).ready(function($) {
            $(".scroll").click(function(event){
                event.preventDefault();
                $('html,body').animate({scrollTop:$(this.hash).offset().top - 53},1000);
            });
        });
    </script>

    <!-- Google Analytics-->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-100434466-1', 'auto');
        ga('send', 'pageview');
    </script>

    <!-- firebase through CDN -->
    <script src="https://www.gstatic.com/firebasejs/4.1.0/firebase.js"></script>
    <script>

        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyD948shiDf3MGUUvat45QCIvt97DSiJTW8",
            authDomain: "ryanpdev.firebaseapp.com",
            databaseURL: "https://ryanpdev.firebaseio.com",
            projectId: "ryanpdev",
            storageBucket: "ryanpdev.appspot.com",
            messagingSenderId: "536412277169"
        };
        firebase.initializeApp(config);


        function signup(){

            const password = $('#password').val();
            const email = $('#email').val();

            firebase.auth().createUserWithEmailAndPassword(email, password).then(function(user) {
                $('#login-signup-error-message').hide();
            }, function(error) {
                    var errorCode = error.code;
                    var errorMessage = error.message;
                $('#login-signup-error-message').show();
                $('#login-signup-error-message').html('<strong>Whoops!</strong> There was a problem signing you up.');
            }
            );
        }

        function login(){

            const password = $('#password').val();
            const email = $('#email').val();

            firebase.auth().signInWithEmailAndPassword(email, password).then(function(user){
                $('#login-signup-error-message').hide();
            },function(error) {
                // Handle Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
                console.log(errorCode, errorMessage);
                $('#login-signup-error-message').show();
                $('#login-signup-error-message').html('<strong>Whoops!</strong> You were unable to be logged in.');
            });
        }

        function logout(){
            firebase.auth().signOut();
        }

        firebase.auth().onAuthStateChanged(function(user) {
            if (user) { //user is the same as firebase.auth().currentUser
                $('#login-signup-nav-item').css('color', '#449d44');
                $('#login-signup-nav-item').text(user.email);
                $('#login-signup-modal').modal('hide');
                $('#logout-nav-item').show();
            } else {
                $('#login-signup-nav-item').text("Sign In");
                $('#login-signup-nav-item').css('color', '#9d9d9d');
                $('#logout-nav-item').hide();

            }
        });


        //nothing to do with firebase, should move elsewhere
        function toggleModal(){
            $('#login-signup-modal').modal('toggle');
        }

        $('.expand-pane').click(toggleModal());


        $(document).ready(function(){
            //page initialization code (won't be with firebase code probably)
            if(firebase.auth().currentUser){
                $('#logout-nav-item').show();
            }else{
                $('#logout-nav-item').hide();
            }
        });

        //firebase reference to the projects object in the database
        const projectsRef = firebase.database().ref().child("projects");

        //read data once and build the projects section, this will change eventually
        projectsRef.once('value').then(function(snapshot){
            var projects = snapshot.val();
            for (var project in projects) {
                if (projects.hasOwnProperty(project)) {
                    var projectControlsHTML = '<div class="project-box content-1 container"><div class="row"><div class="col-xs-12 col-md-4"><div class="row project-title-box"> <div class="col-xs-2"><div class="upvote-downvote"><div class="glyphicon glyphicon-triangle-top upvote" onclick="upvoteProject(\'' + projects[project].title + '\')"></div><div class="glyphicon glyphicon-triangle-bottom downvote" onclick="downvoteProject(\'' + projects[project].title + '\')"></div><div id="' + projects[project].title.toString().split(' ').join('') + '_votes' + '" class="count">' + projects[project].votes + '</div></div></div><div class="col-xs-10"> <h1>' + projects[project].title + '</h1></div></div><div class="row"><div class="col-xs-12"><img class="img-responsive" src="' + projects[project].image + '" alt="' + projects[project].title + '"/></div></div></div><div class="col-xs-12 col-md-8"><div class="project-description-box">' + projects[project].description + '</div></div></div></div>';
                    $('#projects-box').append(projectControlsHTML);
                }
            }
        });

        //when something in the project changes, update the votes for it, I think this is doing more than it should have to
        projectsRef.on('child_changed', function(snapshot){
            var votes_selector = '#' + snapshot.val().title.toString().split(' ').join('') + '_votes';
            $(votes_selector).html(snapshot.val().votes);
        });

        function upvoteProject(projectId){
            const projectVotesRef = firebase.database().ref().child("projects").child(projectId);
            projectVotesRef.once('value').then(function(snapshot){
                projectVotesRef.update({"votes" :snapshot.val().votes + 1});
            });
        }

        function downvoteProject(projectId){
            const projectVotesRef = firebase.database().ref().child("projects").child(projectId);
            projectVotesRef.once('value').then(function(snapshot){
                projectVotesRef.update({"votes" :snapshot.val().votes - 1});
            });
        }
    </script>

    <title>ryanpdev - Home</title>
</head>

<body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">ryanpdev.com</a>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav navbar-left">
                    <li class="active"><a href="#about" class="scroll">About</a></li>
                    <li><a href="#projects" class="scroll">Projects</a></li>
                    <li><a href="#learning-log" class="scroll">Learning Log</a></li>
                    <li><a href="#business-inquiries" class="scroll">Business Inquiries</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a id="login-signup-nav-item" onclick="toggleModal()">Sign In</a></li>
                    <li><a id="logout-nav-item" onclick="logout()">Log Out</a></li>
                </ul>
            </div>
        </div>
    </nav>


    <!-- Main Body-->
    <div id="main-body">
        <img class="responsive-image-background" src="https://firebasestorage.googleapis.com/v0/b/ryanpdev.appspot.com/o/atlanta_bmw.jpg?alt=media&token=08c89691-9ab5-46af-8bbb-50242476afe6"/>
        <!-- profile section -->
        <div class="profile-container row">
            <div class="col-lg-4 hidden-xs"></div>
                <div class="col-lg-4 col-xs-12">
                    <div class="row">
                        <div class="col-xs-12">
                            <img class="img-circle profile-image" src="https://firebasestorage.googleapis.com/v0/b/ryanpdev.appspot.com/o/ryan_face.jpg?alt=media&token=6ba74421-9406-4ffe-a72a-a417b5490317"/>
                        </div>
                        <div class="col-xs-12 center-block profile-title">
                            Software Engineer
                        </div>
                    </div>
                </div>
            <div class="col-lg-4 hidden-xs"></div>
        </div>

        <div class="projects container-fluid">
            <div class="row">
                <!-- projects are dynamically loaded in here from firebase -->
                <div id="projects-box">

                </div>
            </div>
        </div>
    </div>


    <!--Modal for signing in and logging up, not part of main page-->
    <div class="modal fade" id="login-signup-modal" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Login/Sign Up</h4>
                </div>
                <div class="modal-body">
                    <div class="login-signup-modal">
                        <div class="row center-block">
                            <form onsubmit="return false;">
                                <div class="form-group">
                                    <label for="email">Email:</label>
                                    <input type="email" class="form-control" id="email" placeholder="Enter email" name="email">
                                </div>
                                <div class="form-group">
                                    <label for="password">Password:</label>
                                    <input type="password" class="form-control" id="password" placeholder="Enter password" name="pwd">
                                </div>
                            </form>
                            <div id="login-signup-error-message" class="alert alert-danger" hidden>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" onclick="signup()">Sign Up</button>
                    <button class="btn btn-primary" onclick="login()">Log In</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>


